See the comments in the code. 
